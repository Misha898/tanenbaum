#include <stddef.h>
#include <stdlib.h>
#include <stdint.h>
#include <errno.h>
#include "newlib_syscalls.h"
/*  _sbrk() specific for stm32f407vet mcu
 *  heap is allocated on CCMRAM just for my fun
 * _impure_ptr
 */
/* BaseType_t is uint32_t on armv8m */
extern uint32_t xTaskResumeAll(void);
extern void vTaskSuspendAll(void);
uint8_t *_sbrk(int incr)
{
#define HEAP_SIZE 64 * 1024 /*  size of CCM memory, 64 KB */
	static uint8_t heap[HEAP_SIZE]
		__attribute__((section(".ccmram")));
	static uint8_t *heap_end = heap; /*  initial value */
	uint8_t *prev_heap_end;
	vTaskSuspendAll();
	prev_heap_end = heap_end;
	if (heap_end + incr > heap + HEAP_SIZE) {
		errno = ENOMEM;
		return (uint8_t *) -1;
	}
	heap_end += incr;
	xTaskResumeAll();
	return prev_heap_end;
}


int _write (int __fd, const void *__buf, size_t __nbyte)
{

}

int _close (int __fildes)
{

}


long _lseek (int __fildes, long __offset, int __whence)
{

}

int _read (int __fd, void *__buf, size_t __nbyte)
{

}
int fstat (int __fd, struct stat *__sbuf )
{

}

int isatty (int __fildes)
{

}
